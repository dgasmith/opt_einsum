
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../getting_started/sharing_intermediates/">
      
      
        <link rel="next" href="../optimal_path/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Introduction - Optimized Einsum</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Optimized Einsum" class="md-header__button md-logo" aria-label="Optimized Einsum" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Optimized Einsum
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Introduction
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dgasmith/opt_einsum" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    dgasmith/opt_einsum
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Optimized Einsum" class="md-nav__button md-logo" aria-label="Optimized Einsum" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Optimized Einsum
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dgasmith/opt_einsum" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    dgasmith/opt_einsum
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/input_format/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Input Format
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backends & GPU Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/reusing_paths/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reusing Paths
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/sharing_intermediates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharing Intermediates
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Path Information
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Path Information
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#examining-the-path" class="md-nav__link">
    <span class="md-ellipsis">
      Examining the Path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#format-of-the-path" class="md-nav__link">
    <span class="md-ellipsis">
      Format of the Path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Comparison
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimal_path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimal Path
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../branching_path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Branching Path
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../greedy_path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Greedy Path
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../random_greedy_path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Random-Greedy Path
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dp_path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dynamic Programming Path
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom_paths/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Path Optimizers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/dask_reusing_intermediaries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reusing Intermediaries with Dask
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/large_expr_with_greedy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Large Expressions with Greedy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#examining-the-path" class="md-nav__link">
    <span class="md-ellipsis">
      Examining the Path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#format-of-the-path" class="md-nav__link">
    <span class="md-ellipsis">
      Format of the Path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Comparison
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="introduction">Introduction</h1>
<p>Performing an optimized tensor contraction to speed up <code>einsum</code> involves two
key stages:</p>
<ol>
<li>Finding a pairwise contraction order, or <strong>'path'</strong>.</li>
<li>Performing the sequence of contractions given this path.</li>
</ol>
<p>The better the quality of path found in the first step, the quicker the actual
contraction in the second step can be -- often dramatically. However, finding
the <em>optimal</em> path is an NP-hard problem that can quickly become intractable,
meaning that a  balance must be struck between the time spent finding a path,
and its quality. <code>opt_einsum</code> handles this by using several path finding
algorithms, which can be manually specified using the <code>optimize</code> keyword.
These are:</p>
<ul>
<li>The <code>'optimal'</code> strategy - an exhaustive search of all possible paths</li>
<li>The <code>'dynamic-programming'</code> strategy - a near-optimal search based off dynamic-programming</li>
<li>The <code>'branch'</code> strategy - a more restricted search of many likely paths</li>
<li>The <code>'greedy'</code> strategy - finds a path one step at a time using a cost
  heuristic</li>
</ul>
<p>By default (<code>optimize='auto'</code>), <a href="../../api_reference/#opt_einsumcontract"><code>opt_einsum.contract</code></a> will select the
best of these it can while aiming to keep path finding times below around 1ms.
An analysis of each of these approaches' performance can be found at the bottom of this page.</p>
<p>For large and complex contractions, there is the <code>'random-greedy'</code> approach,
which samples many (by default 32) greedy paths and can be customized to
explicitly spend a maximum amount of time searching. Another preset,
<code>'random-greedy-128'</code>, uses 128 paths for a more exhaustive search.
See <a href="../random_greedy_path/"><code>RandomGreedyPath</code></a> page for more details on configuring these.</p>
<p>Finally, there is the <code>'auto-hq'</code> preset which targets a much larger search
time (~1sec) in return for finding very high quality paths, dispatching to the
<code>'optimal'</code>, <code>'dynamic-programming'</code> and then <code>'random-greedy-128'</code> paths
depending on contraction size.</p>
<p>If you want to find the path separately to performing the
contraction, or just inspect information about the path found, you can use the
function <a href="../../api_reference/#opt_einsumcontract_path"><code>opt_einsum.contract_path</code></a>.</p>
<h2 id="examining-the-path">Examining the Path</h2>
<p>As an example, consider the following expression found in a perturbation theory (one of ~5,000 such expressions):</p>
<div class="highlight"><pre><span></span><code><span class="s1">&#39;bdik,acaj,ikab,ajac,ikbd&#39;</span>
</code></pre></div>
<p>At first, it would appear that this scales like N^7 as there are 7 unique indices; however, we can define a intermediate to reduce this scaling.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># (N^5 scaling)</span>
<span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;bdik,ikab,ikbd&#39;</span>

<span class="c1"># (N^4 scaling)</span>
<span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;acaj,ajac,a&#39;</span>
</code></pre></div>
<p>This is a single possible path to the final answer (and notably, not the most optimal) out of many possible paths. Now, let opt_einsum compute the optimal path:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">opt_einsum</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">oe</span>

<span class="c1"># Take a complex string</span>
<span class="n">einsum_string</span> <span class="o">=</span> <span class="s1">&#39;bdik,acaj,ikab,ajac,ikbd-&gt;&#39;</span>

<span class="c1"># Build random views to represent this contraction</span>
<span class="n">unique_inds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">einsum_string</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">}</span>
<span class="n">index_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<span class="n">sizes_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique_inds</span><span class="p">,</span> <span class="n">index_size</span><span class="p">))</span>
<span class="n">views</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">build_views</span><span class="p">(</span><span class="n">einsum_string</span><span class="p">,</span> <span class="n">sizes_dict</span><span class="p">)</span>

<span class="n">path</span><span class="p">,</span> <span class="n">path_info</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">contract_path</span><span class="p">(</span><span class="n">einsum_string</span><span class="p">,</span> <span class="o">*</span><span class="n">views</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="c1">#&gt; [(0, 4), (1, 3), (0, 1), (0, 1)]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">path_info</span><span class="p">)</span>
<span class="c1">#&gt;   Complete contraction:  bdik,acaj,ikab,ajac,ikbd-&gt;</span>
<span class="c1">#&gt;          Naive scaling:  7</span>
<span class="c1">#&gt;      Optimized scaling:  4</span>
<span class="c1">#&gt;       Naive FLOP count:  2.387e+8</span>
<span class="c1">#&gt;   Optimized FLOP count:  8.068e+4</span>
<span class="c1">#&gt;    Theoretical speedup:  2958.354</span>
<span class="c1">#&gt;   Largest intermediate:  1.530e+3 elements</span>
<span class="c1">#&gt; --------------------------------------------------------------------------------</span>
<span class="c1">#&gt; scaling        BLAS                current                             remaining</span>
<span class="c1">#&gt; --------------------------------------------------------------------------------</span>
<span class="c1">#&gt;    4              0         ikbd,bdik-&gt;ikb                  acaj,ikab,ajac,ikb-&gt;</span>
<span class="c1">#&gt;    4    GEMV/EINSUM            ikb,ikab-&gt;a                         acaj,ajac,a-&gt;</span>
<span class="c1">#&gt;    3              0           ajac,acaj-&gt;a                                 a,a-&gt;</span>
<span class="c1">#&gt;    1            DOT                  a,a-&gt;                                    -&gt;</span>
</code></pre></div>
<p>We can then check that actually performing the contraction produces the expected result:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">einsum_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;bdik,acaj,ikab,ajac,ikbd-&gt;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">views</span><span class="p">)</span>
<span class="n">contract_result</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s2">&quot;bdik,acaj,ikab,ajac,ikbd-&gt;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">views</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">einsum_result</span><span class="p">,</span> <span class="n">contract_result</span><span class="p">)</span>
<span class="c1">#&gt; True</span>
</code></pre></div>
<p>By contracting terms in the correct order we can see that this expression can be computed with N^4 scaling. Even with the overhead of finding the best order or 'path' and small dimensions,
<code>opt_einsum</code> is roughly 3000 times faster than pure einsum for this expression.</p>
<h2 id="format-of-the-path">Format of the Path</h2>
<p>Let us look at the structure of a canonical <code>einsum</code> path found in NumPy and its optimized variant:</p>
<div class="highlight"><pre><span></span><code><span class="n">einsum_path</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
<span class="n">opt_path</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
</code></pre></div>
<p>In opt_einsum each element of the list represents a single contraction.
In the above example the einsum_path would effectively compute the result as a single contraction identical to that of <code>einsum</code>, while the
opt_path would perform four contractions in order to reduce the overall scaling.
The first tuple in the opt_path, <code>(1,3)</code>, pops the second and fourth terms, then contracts them together to produce a new term which is then appended to the list of terms, this is continued until all terms are contracted.
An example should illuminate this:</p>
<div class="highlight"><pre><span></span><code><span class="go">---------------------------------------------------------------------------------</span>
<span class="go">scaling   GEMM                   current                                remaining</span>
<span class="go">---------------------------------------------------------------------------------</span>
<span class="go">terms = [&#39;bdik&#39;, &#39;acaj&#39;, &#39;ikab&#39;, &#39;ajac&#39;, &#39;ikbd&#39;] contraction = (1, 3)</span>
<span class="go">  3     False              ajac,acaj-&gt;a                       bdik,ikab,ikbd,a-&gt;</span>
<span class="go">terms = [&#39;bdik&#39;, &#39;ikab&#39;, &#39;ikbd&#39;, &#39;a&#39;] contraction = (0, 2)</span>
<span class="go">  4     False            ikbd,bdik-&gt;bik                             ikab,a,bik-&gt;</span>
<span class="go">terms = [&#39;ikab&#39;, &#39;a&#39;, &#39;bik&#39;] contraction = (0, 2)</span>
<span class="go">  4     False              bik,ikab-&gt;a                                    a,a-&gt;</span>
<span class="go">terms = [&#39;a&#39;, &#39;a&#39;] contraction = (0, 1)</span>
<span class="go">  1       DOT                    a,a-&gt;                                       -&gt;</span>
</code></pre></div>
<p>A path specified in this format can explicitly be supplied directly to
<a href="../../api_reference/#opt_einsumcontract"><code>opt_einsum.contract</code></a> using the <code>optimize</code> keyword:</p>
<div class="highlight"><pre><span></span><code><span class="n">contract_result</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s2">&quot;bdik,acaj,ikab,ajac,ikbd-&gt;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">views</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="n">opt_path</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">einsum_result</span><span class="p">,</span> <span class="n">contract_result</span><span class="p">)</span>
<span class="c1">#&gt; True</span>
</code></pre></div>
<h2 id="performance-comparison">Performance Comparison</h2>
<p>The following graphs should give some indication of the tradeoffs between path
finding time and path quality. They are generated by finding paths with each
possible algorithm for many randomly generated networks of <code>n</code> tensors with
varying connectivity.</p>
<p>First we have the time to find each path as a function of the number of terms
in the expression:</p>
<p><img alt="Path Finding" src="../../img/path_finding_time.png" /></p>
<p>Clearly the exhaustive (<code>'optimal'</code>, <code>'branch-all'</code>) and exponential
(<code>'branch-2'</code>) searches eventually scale badly, but for modest amounts of
terms they incur only a small overhead. The <code>'random-greedy'</code> approach is not
shown here as it is simply <code>max_repeats</code> times slower than the <code>'greedy'</code>
approach - at least if not parallelized.</p>
<p>Next we can look at the average FLOP speedup (as compared to the easiest path
to find, <code>'greedy'</code>):</p>
<p><img alt="Path Finding" src="../../img/path_found_flops.png" /></p>
<p>One can see that the hierarchy of path qualities is:</p>
<ol>
<li><code>'optimal'</code> (used by auto for <code>n &lt;= 4</code>)</li>
<li><code>'branch-all'</code> (used by auto for <code>n &lt;= 6</code>)</li>
<li><code>'branch-2'</code> (used by auto for <code>n &lt;= 8</code>)</li>
<li><code>'branch-1'</code> (used by auto for <code>n &lt;= 14</code>)</li>
<li><code>'greedy'</code> (used by auto for anything larger)</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The performance of the <code>'random=greedy'</code> approach (which is never used
automatically) can be found separately in <a href="../random_greedy_path/"><code>RandomGreedyPath</code></a> section.</p>
</div>
<p>There are a few important caveats to note with this graph. Firstly, the
benefits of more advanced path finding are very dependent on the complexity of
the expression. For 'simple' contractions, all the different approaches will
<em>mostly</em> find the same path (as here). However, for 'tricky' contractions, there
will be certain cases where the more advanced algorithms will find much better
paths. As such, while this graph gives a good idea of the <em>relative</em> performance
of each algorithm, the 'average speedup' is not a perfect indicator since
worst-case performance might be more critical.</p>
<p>Note that the speedups for any of the methods as compared to a standard
<code>einsum</code> or a naively chosen path (such as <code>path=[(0, 1), (0, 1), ...]</code>)
are all exponentially large and not shown.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../javascript/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>